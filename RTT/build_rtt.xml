<project name="rtt" default="Jar">
	<path id="_basedir">
		<pathelement location="./" />
	</path>
	<path id="jdk">
		<pathelement location="C:\Program Files (x86)\Java\jdk1.6.0_26" />
	</path>
	<property name="_basedir" refid="_basedir" />
	<property name="java.jdk-home" refid="jdk" />

	<!-- = = = = = = = = = = = = = = = = =
	          macrodef: JAXBClean          
	         = = = = = = = = = = = = = = = = = -->
	<macrodef name="JAXBClean">
		<attribute name="package" />
		<sequential>
			<delete>
				<fileset dir="${_basedir}/src-gen/rtt/core/archive">
					<include name="@{package}/*.java" />
				</fileset>
			</delete>
		</sequential>
	</macrodef>

	<!-- = = = = = = = = = = = = = = = = =
	          macrodef: JAXBCreate          
	         = = = = = = = = = = = = = = = = = -->
	<macrodef name="JAXBCreate">
		<attribute name="package" />
		<attribute name="schema" />
		<element name="xjc-args" implicit="yes" optional="yes" />
		<sequential>
			<exec executable="${java.jdk-home}/bin/xjc">
				<arg value="-p" />
				<arg value="rtt.core.archive.@{package}" />
				<arg value="-d" />
				<arg value="${_basedir}/src-gen" />
				<arg value="${_basedir}/schemes/@{schema}" />
				<xjc-args />
			</exec>
		</sequential>
	</macrodef>

	<!-- ================================= 
            Configurations
         ================================= -->
	<target name="Clean Config">
		<JAXBClean package="configuration" />
	</target>

	<target name="XJC Config" depends="Clean Config">
		<JAXBCreate package="configuration" schema="Configuration.xsd" />
	</target>

	<!-- ================================= 
	         Testsuite
	     ================================= -->
	<target name="Clean Testsuite">
		<JAXBClean package="testsuite" />
	</target>

	<target name="XJC Testsuite" depends="Clean Testsuite">
		<JAXBCreate package="testsuite" schema="TestSuite.xsd" />
	</target>

	<!-- ================================= 
		     Input
		 ================================= -->
	<target name="Clean Input">
		<JAXBClean package="input" />
	</target>

	<target name="XJC Input" depends="Clean Input">
		<JAXBCreate package="input" schema="Input.xsd" />
	</target>

	<!-- ================================= 
	         Output
	     ================================= -->
	<target name="Clean Output">
		<JAXBClean package="output" />
	</target>

	<target name="XJC Output" depends="Clean Output">
		<JAXBCreate package="output" schema="Output.xsd" />
	</target>

	<!-- ================================= 
	         History
	     ================================= -->
	<target name="Clean History">
		<JAXBClean package="history" />
	</target>

	<target name="XJC History" depends="Clean History">
		<JAXBCreate package="history" schema="History.xsd">
			<arg value="-b" />
			<arg value="${_basedir}/schemes/History.xjb" />
		</JAXBCreate>
	</target>

	<!-- ================================= 
	         Logging
	     ================================= -->
	<target name="Clean Logging">
		<JAXBClean package="logging" />
	</target>

	<target name="XJC Logging" depends="Clean Logging">
		<JAXBCreate package="logging" schema="Log.xsd">
			<arg value="-b" />
			<arg value="${_basedir}/schemes/Log.xjb" />
		</JAXBCreate>
	</target>

	<!-- ================================= 
	         Main
	     ================================= -->
	<target name="Clean XJC">
		<antcall target="Clean Config" />
		<antcall target="Clean Testsuite" />
		<antcall target="Clean Output" />
		<antcall target="Clean Input" />
		<antcall target="Clean History" />
		<antcall target="Clean Logging" />
	</target>

	<target name="Clean Distribution">
		<delete includeemptydirs="true">
			<fileset dir="${_basedir}/distribution">
				<include name="rtt_1.0.jar" />
				<include name="rtt_src.zip" />
				<include name="javadoc/**/*" />
			</fileset>
		</delete>
	</target>

	<!-- Generate JAXB implementation -->
	<target name="XJC ALL">
		<antcall target="XJC Config" />
		<antcall target="XJC Testsuite" />
		<antcall target="XJC Output" />
		<antcall target="XJC Input" />
		<antcall target="XJC History" />
		<antcall target="XJC Logging" />
	</target>

	<target name="Clean_XJC_Jar">
		<antcall target="XJC ALL" />
		<antcall target="Jar" />
	</target>

	<!-- Create *.jar distribution -->
	<target name="Jar">
		<jar destfile="${_basedir}/distribution/rtt_1.0.jar" index="false" update="false" compress="false">
			<manifest>
				<attribute name="Main-Class" value="rtt.core.RegressionTestTool" />
			</manifest>
			<zipfileset src="${_basedir}/sources/libraries/truezip-6.7.jar" />
			<zipfileset src="${_basedir}/sources/libraries/jewelcli-0.6.jar" />
			<fileset dir="${_basedir}">
				<include name="RTT-License.txt" />
				<include name="TrueZip-License.txt" />
				<include name="JewelCli-License.txt" />
				<include name="headliner.treedistance-License.txt" />
			</fileset>
			<fileset dir="${_basedir}/implementation">
				<include name="**/taskdef.properties" />
				<include name="headliner/treedistance/Makefile" />
			</fileset>
			<fileset dir="${_basedir}/schemes">
				<include name="**/*.xsd" />
				<include name="**/*.xslt" />
			</fileset>
			<fileset dir="${_basedir}/binary">
				<include name="**/*.class" />
				<exclude name="rtt/core/tests/**/*" />
			</fileset>
		</jar>
	</target>

	<!-- Create source code distribution -->
	<target name="SrcDistribution" depends="Clean XJC, Clean Distribution">
		<zip destfile="${_basedir}/distribution/rtt_src.zip" encoding="UTF-8" compress="true" update="false">
			<fileset dir="${_basedir}">
				<include name="**/*" />
				<exclude name="binary" />
				<exclude name="binary/**/*" />
				<exclude name="distribution" />
				<exclude name="distribution/**/*" />
				<exclude name="sources/applications" />
				<exclude name="sources/applications/**/*" />
			</fileset>
		</zip>
	</target>


	<!-- need to update -->
	<target name="Javadoc">
		<javadoc access="public" author="true" destdir="${_basedir}/distribution/javadoc" doctitle="RTT" nodeprecated="false" nodeprecatedlist="false" noindex="false" nonavbar="false" notree="false" source="1.6" sourcepath="${_basedir}/implementation" splitindex="true" use="true" version="true" overview="${_basedir}/implementation/overview.html">

			<package name="rtt.core" />
			<package name="rtt.core.urils" />
			<package name="rtt.core.ant" />
			<package name="rtt.core.annotations" />
			<package name="rtt.core.cli" />
			<package name="rtt.core.exceptions" />
			<classpath>
				<fileset dir="${_basedir}/sources/libraries">
					<include name="*.jar" />
				</fileset>
			</classpath>
		</javadoc>
	</target>
</project>
