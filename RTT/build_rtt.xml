<project name="rtt" default="Jar">
	<path id="_basedir">
		<pathelement location="./" />
	</path>
	<path id="jdk">
		<pathelement location="C:\Program Files (x86)\Java\jdk1.6.0_26" />
	</path>
	<property name="_basedir" refid="_basedir" />
	<property name="java.jdk-home" refid="jdk" />

	<import file="${_basedir}/build-scripts/jaxb.xml" />

	<!-- Removes all implementation classes -->
	<target name="Clean XJC">
		<antcall target="Clean Config" />
		<antcall target="Clean Testsuite" />
		<antcall target="Clean Output" />
		<antcall target="Clean Input" />
		<antcall target="Clean History" />
		<antcall target="Clean Logging" />
	</target>

	<!-- Generate JAXB implementation -->
	<target name="XJC ALL">
		<antcall target="XJC Config" />
		<antcall target="XJC Testsuite" />
		<antcall target="XJC Output" />
		<antcall target="XJC Input" />
		<antcall target="XJC History" />
		<antcall target="XJC Logging" />
	</target>

	<!-- Refresh all classes and create jar -->
	<target name="Clean_XJC_Jar">
		<antcall target="XJC ALL" />
		<antcall target="Jar" />
	</target>

	<target name="Clean Distribution">
		<delete includeemptydirs="true">
			<fileset dir="${_basedir}/distribution">
				<include name="rtt_1.0.jar" />
				<include name="rtt_src.zip" />
				<include name="javadoc/**/*" />
			</fileset>
		</delete>
	</target>
	
	<!-- Create *.jar distribution -->
	<target name="Jar">
		<jar destfile="${_basedir}/distribution/rtt_1.0.jar" index="false" update="false" compress="false">
			<manifest>
				<attribute name="Main-Class" value="rtt.core.RegressionTestTool" />
			</manifest>
			<zipfileset src="${_basedir}/sources/libraries/truezip-6.7.jar" />
			<zipfileset src="${_basedir}/sources/libraries/jewelcli-0.6.jar" />
			<fileset dir="${_basedir}">
				<include name="RTT-License.txt" />
				<include name="TrueZip-License.txt" />
				<include name="JewelCli-License.txt" />
				<include name="headliner.treedistance-License.txt" />
			</fileset>
			<fileset dir="${_basedir}/implementation">
				<include name="**/taskdef.properties" />
				<include name="headliner/treedistance/Makefile" />
			</fileset>
			<fileset dir="${_basedir}/schemes">
				<include name="**/*.xsd" />
				<include name="**/*.xslt" />
			</fileset>
			<fileset dir="${_basedir}/binary">
				<include name="**/*.class" />
				<exclude name="rtt/core/tests/**/*" />
			</fileset>
		</jar>
	</target>

	<!-- Create source code distribution -->
	<target name="SrcDistribution" depends="Clean XJC, Clean Distribution">
		<zip destfile="${_basedir}/distribution/rtt_src.zip" encoding="UTF-8" compress="true" update="false">
			<fileset dir="${_basedir}">
				<include name="**/*" />
				<exclude name="binary" />
				<exclude name="binary/**/*" />
				<exclude name="distribution" />
				<exclude name="distribution/**/*" />
				<exclude name="sources/applications" />
				<exclude name="sources/applications/**/*" />
			</fileset>
		</zip>
	</target>

	<!-- Creates Javadoc (todo) -->
	<target name="Javadoc">
		<javadoc access="public" author="true" destdir="${_basedir}/distribution/javadoc" doctitle="RTT" nodeprecated="false" nodeprecatedlist="false" noindex="false" nonavbar="false" notree="false" source="1.6" sourcepath="${_basedir}/implementation" splitindex="true" use="true" version="true" overview="${_basedir}/implementation/overview.html">
			<package name="rtt.core" />
			<package name="rtt.core.utils" />
			<package name="rtt.ant" />
			<package name="rtt.annotations" />
			<package name="rtt.core.cli" />
			<package name="rtt.core.exceptions" />
			<classpath>
				<fileset dir="${_basedir}/sources/libraries">
					<include name="*.jar" />
				</fileset>
			</classpath>
		</javadoc>
	</target>
</project>
