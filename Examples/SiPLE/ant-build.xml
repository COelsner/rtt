<?xml version="1.0" encoding="UTF-8"?>
<project name="SiPLE" default="build-jar">
	<target name="clean">
		<delete dir="src-gen" failonerror="false" />
		<delete dir="java-bin" failonerror="false" />
		<mkdir dir="src-gen" />
		<mkdir dir="java-bin" />
	</target>
	
	<target name="make-syntax">
		<java jar="tools/jflex.jar" fork="true" failonerror="true">
			<arg line="-d src-gen/siple specifications/Lexer.jflex" />
		</java>
		<java jar="tools/beaver.jar" fork="true" failonerror="true">
			<arg line="-c -d src-gen specifications/Parser.beaver" />
		</java>
	</target>
	
	<target name="make-semantic">
		<java jar="tools/jastadd2.jar" fork="true" failonerror="true">
    		<arg line="--rewrite --package='siple.ast' --o=src-gen specifications/*.ast specifications/*.jrag"/>
    	</java>
	</target>
	
	<target name="make-binary">
		<javac srcdir="src:src-gen" destdir="java-bin"
			classpath="tools/beaver-rt.jar"
			encoding="utf-8" deprecation="true"
			failonerror="true">
		</javac>
	</target>
	
	<target name="build-jar" depends="clean">
        <delete file="siple.jar" />
    	<antcall target="make-syntax" />
    	<antcall target="make-semantic" />
    	<antcall target="make-binary" />
		<jar destfile="siple.jar"
			basedir="java-bin"
			manifest="manifest.txt"
			includes="**/*" />
    </target>
</project>
